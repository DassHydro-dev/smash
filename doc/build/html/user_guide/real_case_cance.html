
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Real case - Cance &#8212; smash 0.1.0 documentation</title>
  <script>
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1e1de1a1873e13ef5536" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1e1de1a1873e13ef5536" rel="stylesheet">

  
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/6.1.2/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/smash.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1e1de1a1873e13ef5536">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/real_case_cance';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Model initialization" href="model_initialization.html" />
    <link rel="prev" title="Practice case" href="practice_case.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="light">

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
    <img src="../_static/logo_smash.svg" class="logo__image only-light" alt="Logo image">
    <img src="../_static/logo_smash.svg" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../getting_started/index.html">
                        Getting started
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="index.html">
                        User guide
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../api_reference/index.html">
                        API Reference
                    </a>
                </li>
                
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      <div class="navbar-end-item navbar-end__search-button-container">
        
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
      </div>
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" data-toggle="tooltip">
    <a class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="fa-regular fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://gitlab.irstea.fr/francois.colleoni/smash/" title="GitLab" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-gitlab"></i></span>
            <label class="sr-only">GitLab</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>


  
  <div class="search-button-container--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
  </div>

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../getting_started/index.html">
                        Getting started
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="index.html">
                        User guide
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../api_reference/index.html">
                        API Reference
                    </a>
                </li>
                
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" data-toggle="tooltip">
    <a class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="fa-regular fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://gitlab.irstea.fr/francois.colleoni/smash/" title="GitLab" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-gitlab"></i></span>
            <label class="sr-only">GitLab</label></a>
        </li>
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
  <p class="bd-links__title" role="heading" aria-level="1">
    Section Navigation
  </p>
  <div class="bd-toc-item navbar-nav">
    <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="practice_case.html">Practice case</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Real case - Cance</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_initialization.html">Model initialization</a></li>
</ul>

  </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

      </div>
      <main class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <div class="section" id="real-case-cance">
<span id="user-guide-real-case-cance"></span><h1>Real case - Cance<a class="headerlink" href="#real-case-cance" title="Permalink to this heading">#</a></h1>
<p>A real case is considered: <code class="docutils literal notranslate"><span class="pre">the</span> <span class="pre">Cance</span> <span class="pre">river</span> <span class="pre">catchment</span> <span class="pre">at</span> <span class="pre">Sarras</span></code>, a right bank tributary of the Rhône river.</p>
<a class="reference internal image-reference" href="../_images/real_case_cance_catchment.png"><img alt="../_images/real_case_cance_catchment.png" class="align-center" src="../_images/real_case_cance_catchment.png" style="width: 400px;" /></a>
<p>First, open a Python interface:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>python3
</pre></div>
</div>
<div class="section" id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h2>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">smash</span>

<span class="gp">In [2]: </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="gp">In [3]: </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="section" id="model-object-creation">
<h2>Model object creation<a class="headerlink" href="#model-object-creation" title="Permalink to this heading">#</a></h2>
<p>Creating a <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> requires two input arguments: <code class="docutils literal notranslate"><span class="pre">setup</span></code> and <code class="docutils literal notranslate"><span class="pre">mesh</span></code>. For this case, it is possible to directly load the both input dictionnaries using the <a class="reference internal" href="../api_reference/smash/smash.load_dataset.html#smash.load_dataset" title="smash.load_dataset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">smash.load_dataset()</span></code></a> method.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="n">setup</span><span class="p">,</span> <span class="n">mesh</span> <span class="o">=</span> <span class="n">smash</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;Cance&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="setup-argument">
<span id="user-guide-setup-argument"></span><h3>Setup argument<a class="headerlink" href="#setup-argument" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">setup</span></code> is a dictionary that allows to initialize <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> (i.e. allocate the necessary setup Fortran arrays).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Each key and associated values that can be passed into the <code class="docutils literal notranslate"><span class="pre">setup</span></code> dictionary are detailed in the User Guide section: <a class="reference internal" href="model_initialization.html#user-guide-model-initialization-setup"><span class="std std-ref">Model initialization</span></a>.</p>
</div>
<p>Compared to the <a class="reference internal" href="practice_case.html#user-guide-practice-case"><span class="std std-ref">Practice case</span></a>, more options have been filled in the <code class="docutils literal notranslate"><span class="pre">setup</span></code> dictionary.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="n">setup</span>
<span class="gh">Out[5]: </span><span class="go"></span>
<span class="go">{&#39;dt&#39;: 3600,</span>
<span class="go"> &#39;start_time&#39;: &#39;2014-09-15 00:00&#39;,</span>
<span class="go"> &#39;end_time&#39;: &#39;2014-11-14 00:00&#39;,</span>
<span class="go"> &#39;read_qobs&#39;: True,</span>
<span class="go"> &#39;qobs_directory&#39;: &#39;/home/livillenave/Documents/distant/misc/smash/smash/dataset/Cance/qobs&#39;,</span>
<span class="go"> &#39;read_prcp&#39;: True,</span>
<span class="go"> &#39;prcp_format&#39;: &#39;tif&#39;,</span>
<span class="go"> &#39;prcp_conversion_factor&#39;: 0.1,</span>
<span class="go"> &#39;prcp_directory&#39;: &#39;/home/livillenave/Documents/distant/misc/smash/smash/dataset/Cance/prcp&#39;,</span>
<span class="go"> &#39;read_pet&#39;: True,</span>
<span class="go"> &#39;pet_format&#39;: &#39;tif&#39;,</span>
<span class="go"> &#39;pet_conversion_factor&#39;: 1,</span>
<span class="go"> &#39;daily_interannual_pet&#39;: True,</span>
<span class="go"> &#39;pet_directory&#39;: &#39;/home/livillenave/Documents/distant/misc/smash/smash/dataset/Cance/pet&#39;,</span>
<span class="go"> &#39;read_descriptor&#39;: True,</span>
<span class="go"> &#39;descriptor_name&#39;: [&#39;slope&#39;, &#39;dd&#39;],</span>
<span class="go"> &#39;exchange_module&#39;: 1,</span>
<span class="go"> &#39;routing_module&#39;: 1,</span>
<span class="go"> &#39;descriptor_directory&#39;: &#39;/home/livillenave/Documents/distant/misc/smash/smash/dataset/Cance/descriptor&#39;}</span>
</pre></div>
</div>
<p>To get into the details:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dt</span></code>: the calculation time step in s,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">start_time</span></code>: the beginning of the simulation,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">end_time</span></code>: the end of the simulation,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read_qobs</span></code>: whether or not to read observed discharges files,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">qobs_directory</span></code>: the path to the observed discharges files (this path is automatically generated when you load the data),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read_prcp</span></code>: whether or not to read precipitation files,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prcp_format</span></code>: the precipitation files format (<code class="docutils literal notranslate"><span class="pre">tif</span></code> format is the only available at the moment),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prcp_conversion_factor</span></code>: the precipitation conversion factor (the precipitation value will be <strong>multiplied</strong> by the conversion factor),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prcp_directory</span></code>: the path to the precipitaion files (this path is automatically generated when you load the data),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read_pet</span></code>: whether or not to read potential evapotranspiration files,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pet_format</span></code>: the potential evapotranspiration files format (<code class="docutils literal notranslate"><span class="pre">tif</span></code> format is the only available at the moment),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pet_conversion_factor</span></code>: the potential evapotranspiration conversion factor (the potential evapotranspiration value will be <strong>multiplied</strong> by the conversion factor),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">daily_interannual_pet</span></code>: whether or not to read potential evapotranspiration file as daily interannual value desaggregated to the corresponding time step <code class="docutils literal notranslate"><span class="pre">dt</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pet_directory</span></code>: the path to the potential evapotranspiration files (this path is automatically generated when you load the data),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exchange_module</span></code>: Choice of the exchange module (<code class="docutils literal notranslate"><span class="pre">1</span></code> is GR4 exchange module (TODO ref)),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">routing</span> <span class="pre">module</span></code>: Choice of the routing module (<code class="docutils literal notranslate"><span class="pre">1</span></code> is linear routing (TODO ref)).</p></li>
</ul>
<p>Before going into the explanation of the <code class="docutils literal notranslate"><span class="pre">mesh</span></code>, the following section details the structure of the observed discharges, precipitation and potential evapotranspiration files read.</p>
</div>
<div class="section" id="input-data-files-structure">
<h3>Input data files structure<a class="headerlink" href="#input-data-files-structure" title="Permalink to this heading">#</a></h3>
<div class="section" id="observed-dicharge">
<h4>Observed dicharge<a class="headerlink" href="#observed-dicharge" title="Permalink to this heading">#</a></h4>
<p>The observed discharge for one catchment is read from a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file with the following structure:</p>
<table class="table" id="id1">
<caption><span class="caption-text">V3524010.csv</span><a class="headerlink" href="#id1" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>200601010000</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-99.000</p></td>
</tr>
<tr class="row-odd"><td><p>-99.000</p></td>
</tr>
<tr class="row-even"><td><p>…</p></td>
</tr>
<tr class="row-odd"><td><p>1.180</p></td>
</tr>
<tr class="row-even"><td><p>1.185</p></td>
</tr>
</tbody>
</table>
<p>It is a single-column <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file containing the observed discharge values in m<sup>3</sup> /s (negative values correspond to a gap in the chronicle) and whose header is the first time step of the chronicle.
The name of the file, for any catchment, must contains the code of the gauge which is filled in the <code class="docutils literal notranslate"><span class="pre">mesh</span></code> dictionary.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The time step of the header does not have to match the first simulation time step. <a class="reference internal" href="../index.html#module-smash" title="smash"><code class="xref py py-obj docutils literal notranslate"><span class="pre">smash</span></code></a> manages to read the corresponding lines from <code class="docutils literal notranslate"><span class="pre">start_time</span></code>, <code class="docutils literal notranslate"><span class="pre">end_time</span></code> and <code class="docutils literal notranslate"><span class="pre">dt</span></code>.</p>
</div>
</div>
<div class="section" id="precipitation">
<h4>Precipitation<a class="headerlink" href="#precipitation" title="Permalink to this heading">#</a></h4>
<p>The precipitation files must be store for each each time step of the simulation. For one time step, <a class="reference internal" href="../index.html#module-smash" title="smash"><code class="xref py py-obj docutils literal notranslate"><span class="pre">smash</span></code></a> will recursively search in the <code class="docutils literal notranslate"><span class="pre">prcp_directory</span></code>, a file with the following name structure: <code class="docutils literal notranslate"><span class="pre">*&lt;%Y%m%d%H%M&gt;*.&lt;prcp_format&gt;</span></code>.
An example of file name in tif format for the date 2014-09-15 00:00: <code class="docutils literal notranslate"><span class="pre">prcp_201409150000.tif</span></code>. The spatial resolution must be identical to the spatial resolution of the flow directions used for the meshing.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">%Y%m%d%H%M</span></code> is a unique key, the <code class="docutils literal notranslate"><span class="pre">prcp_directory</span></code> (and all subdirectories) can not contains files with similar dates.</p>
</div>
</div>
<div class="section" id="potential-evapotranspiration">
<h4>Potential evapotranspiration<a class="headerlink" href="#potential-evapotranspiration" title="Permalink to this heading">#</a></h4>
<p>The potential evapotranspiration files must be store for each each time step of the simulation. For one time step, <a class="reference internal" href="../index.html#module-smash" title="smash"><code class="xref py py-obj docutils literal notranslate"><span class="pre">smash</span></code></a> will recursively search in the <code class="docutils literal notranslate"><span class="pre">pet_directory</span></code>, a file with the following name structure: <code class="docutils literal notranslate"><span class="pre">*&lt;%Y%m%d%H%M&gt;*.&lt;pet_format&gt;</span></code>.
An example of file name in tif format for the date 2014-09-15 00:00: <code class="docutils literal notranslate"><span class="pre">pet_201409150000.tif</span></code>. The spatial resolution must be identical to the spatial resolution of the flow directions used for the meshing.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">%Y%m%d%H%M</span></code> is a unique key, the <code class="docutils literal notranslate"><span class="pre">pet_directory</span></code> (and all subdirectories) can not contains files with similar dates.</p>
</div>
<p>In case of <code class="docutils literal notranslate"><span class="pre">daily_interannual_pet</span></code>, <a class="reference internal" href="../index.html#module-smash" title="smash"><code class="xref py py-obj docutils literal notranslate"><span class="pre">smash</span></code></a> will recursively search in the <code class="docutils literal notranslate"><span class="pre">pet_directory</span></code>, a file with the following name structure: <code class="docutils literal notranslate"><span class="pre">*&lt;%m%d&gt;*.&lt;pet_format&gt;</span></code>.
An example of file name in tif format for the date 09-15: <code class="docutils literal notranslate"><span class="pre">dia_pet_0915.tif</span></code>. This file will be desaggregated to the corresponding time step <code class="docutils literal notranslate"><span class="pre">dt</span></code>.</p>
</div>
</div>
<div class="section" id="mesh-argument">
<span id="user-guide-mesh-argument"></span><h3>Mesh argument<a class="headerlink" href="#mesh-argument" title="Permalink to this heading">#</a></h3>
<div class="section" id="mesh-composition">
<h4>Mesh composition<a class="headerlink" href="#mesh-composition" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">mesh</span></code> is a dictionary that allows to initialize <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> (i.e. allocate the necessary mesh Fortran arrays).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Each key and associated values that can be passed into the <code class="docutils literal notranslate"><span class="pre">mesh</span></code> dictionary are detailed in the User Guide section: <a class="reference internal" href="model_initialization.html#user-guide-model-initialization-mesh"><span class="std std-ref">Model initialization</span></a>.</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">mesh</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="gh">Out[6]: </span><span class="go">dict_keys([&#39;dx&#39;, &#39;nac&#39;, &#39;ncol&#39;, &#39;ng&#39;, &#39;nrow&#39;, &#39;xmin&#39;, &#39;ymax&#39;, &#39;active_cell&#39;, &#39;area&#39;, &#39;code&#39;, &#39;drained_area&#39;, &#39;flwdir&#39;, &#39;flwdst&#39;, &#39;gauge_pos&#39;, &#39;path&#39;])</span>
</pre></div>
</div>
<p>To get into the details:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dx</span></code>: the calculation spatial step in m,</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [7]: </span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;dx&quot;</span><span class="p">]</span>
<span class="gh">Out[7]: </span><span class="go">1000.0</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">xmin</span></code>: the minimum value of the domain extension in x (it depends on the flow directions projection)</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;xmin&quot;</span><span class="p">]</span>
<span class="gh">Out[8]: </span><span class="go">813000.0</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ymax</span></code>: the maximum value of the domain extension in y (it depends on the flow directions projection)</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [9]: </span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;ymax&quot;</span><span class="p">]</span>
<span class="gh">Out[9]: </span><span class="go">6478000.0</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nrow</span></code>: the number of rows,</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;nrow&quot;</span><span class="p">]</span>
<span class="gh">Out[10]: </span><span class="go">28</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ncol</span></code>: the number of columns,</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [11]: </span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;ncol&quot;</span><span class="p">]</span>
<span class="gh">Out[11]: </span><span class="go">28</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ng</span></code>: the number of gauges,</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [12]: </span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;ng&quot;</span><span class="p">]</span>
<span class="gh">Out[12]: </span><span class="go">3</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nac</span></code>: the number of cells that contribute to any gauge discharge,</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [13]: </span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;nac&quot;</span><span class="p">]</span>
<span class="gh">Out[13]: </span><span class="go">383</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">area</span></code>: the catchments area in m²,</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [14]: </span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span>
<span class="gh">Out[14]: </span><span class="go">array([3.83e+08, 1.08e+08, 2.80e+07], dtype=float32)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code>: the gauges code,</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [15]: </span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span>
<span class="gh">Out[15]: </span><span class="go"></span>
<span class="go">array([[86, 86, 86],</span>
<span class="go">       [51, 51, 51],</span>
<span class="go">       [53, 53, 53],</span>
<span class="go">       [50, 49, 49],</span>
<span class="go">       [52, 53, 55],</span>
<span class="go">       [48, 48, 48],</span>
<span class="go">       [49, 49, 49],</span>
<span class="go">       [48, 48, 48],</span>
<span class="go">       [32, 32, 32],</span>
<span class="go">       [32, 32, 32],</span>
<span class="go">       [32, 32, 32],</span>
<span class="go">       [32, 32, 32],</span>
<span class="go">       [32, 32, 32],</span>
<span class="go">       [32, 32, 32],</span>
<span class="go">       [32, 32, 32],</span>
<span class="go">       [32, 32, 32],</span>
<span class="go">       [32, 32, 32],</span>
<span class="go">       [32, 32, 32],</span>
<span class="go">       [32, 32, 32],</span>
<span class="go">       [32, 32, 32]], dtype=uint8)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This argument is tricky to use because any NumPy uint8 array wrapped must be filled with ASCII values.
One way to retrieve the value from uint8 array is:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [16]: </span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tobytes</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="gh">Out[16]: </span><span class="go">[&#39;V3524010&#39;, &#39;V3515010&#39;, &#39;V3517010&#39;]</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gauge_pos</span></code>: the gauges position in the grid (it must follow <strong>Fortran indexing</strong>),</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [17]: </span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;gauge_pos&quot;</span><span class="p">]</span>
<span class="gh">Out[17]: </span><span class="go"></span>
<span class="go">array([[21, 28],</span>
<span class="go">       [11, 14],</span>
<span class="go">       [ 9, 15]], dtype=int32)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">flwdir</span></code>: the flow directions,</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [18]: </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;flwdir&quot;</span><span class="p">]);</span>

<span class="gp">In [19]: </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flow direction (D8)&quot;</span><span class="p">);</span>

<span class="gp">In [20]: </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Real case - Cance - Flow direction&quot;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../_images/flwdir_rc_Cance_user_guide.png" src="../_images/flwdir_rc_Cance_user_guide.png" />
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dirained_area</span></code>: the drained area in number of cells,</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [21]: </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;drained_area&quot;</span><span class="p">]);</span>

<span class="gp">In [22]: </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Drained area (nb cells)&quot;</span><span class="p">);</span>

<span class="gp">In [23]: </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Real case - Cance - Drained area&quot;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../_images/da_rc_Cance_user_guide.png" src="../_images/da_rc_Cance_user_guide.png" />
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">flwdst</span></code>: the flow distances from the main outlet in m,</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [24]: </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;flwdst&quot;</span><span class="p">]);</span>

<span class="gp">In [25]: </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flow distance (m)&quot;</span><span class="p">);</span>

<span class="gp">In [26]: </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Real case - Cance - Flow distance&quot;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../_images/flwdst_rc_Cance_user_guide.png" src="../_images/flwdst_rc_Cance_user_guide.png" />
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">active_cell</span></code>: the cells that contribute to any gauge discharge (mask),</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [27]: </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;active_cell&quot;</span><span class="p">]);</span>

<span class="gp">In [28]: </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Logical active cell (0: False, 1: True)&quot;</span><span class="p">);</span>

<span class="gp">In [29]: </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Real case - Cance - Active cell&quot;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../_images/active_cell_rc_Cance_user_guide.png" src="../_images/active_cell_rc_Cance_user_guide.png" />
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code>: the calculation path.</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [30]: </span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
<span class="gh">Out[30]: </span><span class="go"></span>
<span class="go">array([[14, 17, 17, ..., 20, 20, 21],</span>
<span class="go">       [28, 22, 20, ..., 26, 27, 28]], dtype=int32)</span>
</pre></div>
</div>
<p>Obviously, the data set included in the <code class="docutils literal notranslate"><span class="pre">mesh</span></code> dictionary is not generated by hand. The method <a class="reference internal" href="../api_reference/smash/smash.generate_mesh.html#smash.generate_mesh" title="smash.generate_mesh"><code class="xref py py-meth docutils literal notranslate"><span class="pre">smash.generate_mesh()</span></code></a> allows from a flow directions file, the gauge coordinates and the area to generate this same data set.</p>
</div>
<div class="section" id="generate-a-mesh-automatically">
<h4>Generate a mesh automatically<a class="headerlink" href="#generate-a-mesh-automatically" title="Permalink to this heading">#</a></h4>
<p>The method required the path to the flow directions <code class="docutils literal notranslate"><span class="pre">tif</span></code> file. Once can load it directly with,</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [31]: </span><span class="n">flwdir</span> <span class="o">=</span> <span class="n">smash</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;flwdir&quot;</span><span class="p">)</span>

<span class="gp">In [32]: </span><span class="n">flwdir</span>
<span class="gh">Out[32]: </span><span class="go">&#39;/home/livillenave/Documents/distant/misc/smash/smash/dataset/France_flwdir.tif&#39;</span>
</pre></div>
</div>
<p>This path leads to a flow directions <code class="docutils literal notranslate"><span class="pre">tif</span></code> file of the whole France at 1km² spatial resolution and Lambert93 projection (<em>EPSG:2154</em>)</p>
<p>Get the gauge coordinates, area and code (this data is considered to be known by the user at the time the meshing is generated):</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [33]: </span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">840_261</span><span class="p">,</span> <span class="mi">826_553</span><span class="p">,</span> <span class="mi">828_269</span><span class="p">]</span>

<span class="gp">In [34]: </span><span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6_457_807</span><span class="p">,</span> <span class="mi">6_467_115</span><span class="p">,</span> <span class="mi">6_469_198</span><span class="p">]</span>

<span class="gp">In [35]: </span><span class="n">area</span> <span class="o">=</span> <span class="p">[</span><span class="mf">381.7</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">,</span> <span class="mi">107</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">,</span> <span class="mf">25.3</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">]</span>

<span class="gp">In [36]: </span><span class="n">code</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;V3524010&quot;</span><span class="p">,</span> <span class="s2">&quot;V3515010&quot;</span><span class="p">,</span> <span class="s2">&quot;V3517010&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> coordinates of the gauge must be in the same projection of the flow directions used for the meshing, here Lambert93 (<em>EPSG:2154</em>).</p>
<p>Call the <a class="reference internal" href="../api_reference/smash/smash.generate_mesh.html#smash.generate_mesh" title="smash.generate_mesh"><code class="xref py py-meth docutils literal notranslate"><span class="pre">smash.generate_mesh()</span></code></a> method:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [37]: </span><span class="n">mesh2</span> <span class="o">=</span> <span class="n">smash</span><span class="o">.</span><span class="n">generate_mesh</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="n">path</span><span class="o">=</span><span class="n">flwdir</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">area</span><span class="o">=</span><span class="n">area</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">,</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">mesh</span></code> created is a dictionnary which is identical to the <code class="docutils literal notranslate"><span class="pre">mesh</span></code> loaded with the <a class="reference internal" href="../api_reference/smash/smash.load_dataset.html#smash.load_dataset" title="smash.load_dataset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">smash.load_dataset()</span></code></a> method.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [38]: </span><span class="n">mesh2</span><span class="p">[</span><span class="s2">&quot;dx&quot;</span><span class="p">],</span> <span class="n">mesh2</span><span class="p">[</span><span class="s2">&quot;nrow&quot;</span><span class="p">],</span> <span class="n">mesh2</span><span class="p">[</span><span class="s2">&quot;ncol&quot;</span><span class="p">],</span> <span class="n">mesh2</span><span class="p">[</span><span class="s2">&quot;ng&quot;</span><span class="p">],</span> <span class="n">mesh2</span><span class="p">[</span><span class="s2">&quot;gauge_pos&quot;</span><span class="p">]</span>
<span class="gh">Out[38]: </span><span class="go"></span>
<span class="go">(1000.0,</span>
<span class="go"> 28,</span>
<span class="go"> 28,</span>
<span class="go"> 3,</span>
<span class="go"> array([[21, 28],</span>
<span class="go">        [11, 14],</span>
<span class="go">        [ 9, 15]], dtype=int32))</span>
</pre></div>
</div>
<p>As a remainder, the <code class="docutils literal notranslate"><span class="pre">mesh</span></code> can be saved to HDF5 using the <a class="reference internal" href="../api_reference/smash/smash.save_mesh.html#smash.save_mesh" title="smash.save_mesh"><code class="xref py py-meth docutils literal notranslate"><span class="pre">smash.save_mesh()</span></code></a> method and reload with the <a class="reference internal" href="../api_reference/smash/smash.read_mesh.html#smash.read_mesh" title="smash.read_mesh"><code class="xref py py-meth docutils literal notranslate"><span class="pre">smash.read_mesh()</span></code></a> method.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [39]: </span><span class="n">smash</span><span class="o">.</span><span class="n">save_mesh</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="s2">&quot;mesh_Cance.hdf5&quot;</span><span class="p">)</span>

<span class="gp">In [40]: </span><span class="n">mesh3</span> <span class="o">=</span> <span class="n">smash</span><span class="o">.</span><span class="n">read_mesh</span><span class="p">(</span><span class="s2">&quot;mesh_Cance.hdf5&quot;</span><span class="p">)</span>

<span class="gp">In [41]: </span><span class="n">mesh3</span><span class="p">[</span><span class="s2">&quot;dx&quot;</span><span class="p">],</span> <span class="n">mesh3</span><span class="p">[</span><span class="s2">&quot;nrow&quot;</span><span class="p">],</span> <span class="n">mesh3</span><span class="p">[</span><span class="s2">&quot;ncol&quot;</span><span class="p">],</span> <span class="n">mesh3</span><span class="p">[</span><span class="s2">&quot;ng&quot;</span><span class="p">],</span> <span class="n">mesh3</span><span class="p">[</span><span class="s2">&quot;gauge_pos&quot;</span><span class="p">]</span>
<span class="gh">Out[41]: </span><span class="go"></span>
<span class="go">(1000.0,</span>
<span class="go"> 28,</span>
<span class="go"> 28,</span>
<span class="go"> 3,</span>
<span class="go"> array([[21, 28],</span>
<span class="go">        [11, 14],</span>
<span class="go">        [ 9, 15]], dtype=int32))</span>
</pre></div>
</div>
<p>Finally, create the <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> object using the <code class="docutils literal notranslate"><span class="pre">setup</span></code> and <code class="docutils literal notranslate"><span class="pre">mesh</span></code> loaded.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [42]: </span><span class="n">model</span> <span class="o">=</span> <span class="n">smash</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>

<span class="gp">In [43]: </span><span class="n">model</span>
<span class="gh">Out[43]: </span><span class="go"></span>
<span class="go">Model dimension: (time: 1440, nrow: 28, ncol: 28)</span>
<span class="go">Model last update: Initialization</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="viewing-model">
<h2>Viewing Model<a class="headerlink" href="#viewing-model" title="Permalink to this heading">#</a></h2>
<p>Similar to the <a class="reference internal" href="practice_case.html#user-guide-practice-case"><span class="std std-ref">Practice case</span></a>, it is possible to visualize what the <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> contains through the 6 attributes: <a class="reference internal" href="../api_reference/smash/smash.Model.setup.html#smash.Model.setup" title="smash.Model.setup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.setup</span></code></a>, <a class="reference internal" href="../api_reference/smash/smash.Model.mesh.html#smash.Model.mesh" title="smash.Model.mesh"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.mesh</span></code></a>, <a class="reference internal" href="../api_reference/smash/smash.Model.input_data.html#smash.Model.input_data" title="smash.Model.input_data"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.input_data</span></code></a>,
<a class="reference internal" href="../api_reference/smash/smash.Model.parameters.html#smash.Model.parameters" title="smash.Model.parameters"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.parameters</span></code></a>, <a class="reference internal" href="../api_reference/smash/smash.Model.states.html#smash.Model.states" title="smash.Model.states"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.states</span></code></a>, <a class="reference internal" href="../api_reference/smash/smash.Model.output.html#smash.Model.output" title="smash.Model.output"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.output</span></code></a>. As we have already detailed in the <a class="reference internal" href="practice_case.html#user-guide-practice-case"><span class="std std-ref">Practice case</span></a> the access to any data, we will only visualize the observed discharges and the spatialized atmospheric forcings here.</p>
<div class="section" id="input-data-observed-discharge">
<h3>Input Data - Observed discharge<a class="headerlink" href="#input-data-observed-discharge" title="Permalink to this heading">#</a></h3>
<p>3 gauges were placed in the meshing. For the sake of clarity, only the most downstream gauge discharge <code class="docutils literal notranslate"><span class="pre">V3524010</span></code> is plotted.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [44]: </span><span class="n">code</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">tobytes</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="gp">In [45]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">qobs</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]);</span>

<span class="gp">In [46]: </span><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.7</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">);</span>

<span class="gp">In [47]: </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time step&quot;</span><span class="p">);</span>

<span class="gp">In [48]: </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Discharge ($m^3/s$)&quot;</span><span class="p">);</span>

<span class="gp">In [49]: </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">code</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</pre></div>
</div>
<img alt="../_images/qobs_rc_Cance_user_guide.png" src="../_images/qobs_rc_Cance_user_guide.png" />
</div>
<div class="section" id="input-data-atmospheric-forcings">
<h3>Input Data - Atmospheric forcings<a class="headerlink" href="#input-data-atmospheric-forcings" title="Permalink to this heading">#</a></h3>
<p>Precipitation and potential evapotranspiration files were read for each time step. For the sake of clarity, only one precipiation grid at time step 1200 is plotted.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [50]: </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">prcp</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1200</span><span class="p">]);</span>

<span class="gp">In [51]: </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Precipitation at time step 1200&quot;</span><span class="p">);</span>

<span class="gp">In [52]: </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Precipitation ($mm/h$)&quot;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../_images/prcp_rc_Cance_user_guide.png" src="../_images/prcp_rc_Cance_user_guide.png" />
<p>It is possible to mask the precipitation grid to only visualize the precipitation on active cells using NumPy method <code class="docutils literal notranslate"><span class="pre">np.where</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [53]: </span><span class="n">ma_prcp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">active_cell</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">prcp</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1200</span><span class="p">]</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [54]: </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ma_prcp</span><span class="p">);</span>

<span class="gp">In [55]: </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Masked precipitation at time step 1200&quot;</span><span class="p">);</span>

<span class="gp">In [56]: </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Precipitation ($mm/h$)&quot;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../_images/ma_prcp_rc_Cance_user_guide.png" src="../_images/ma_prcp_rc_Cance_user_guide.png" />
</div>
</div>
<div class="section" id="run">
<h2>Run<a class="headerlink" href="#run" title="Permalink to this heading">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We consider in the whole section, a model structure composed of 3 reservoirs for production, transfer and routing and a non-conservative exchange.</p>
</div>
<div class="section" id="forward-run">
<h3>Forward run<a class="headerlink" href="#forward-run" title="Permalink to this heading">#</a></h3>
<p>Make a forward run using the <a class="reference internal" href="../api_reference/smash/smash.Model.run.html#smash.Model.run" title="smash.Model.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.run()</span></code></a> method.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [57]: </span><span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="gh">Out[57]: </span><span class="go"></span>
<span class="go">Model dimension: (time: 1440, nrow: 28, ncol: 28)</span>
<span class="go">Model last update: Forward Run</span>
</pre></div>
</div>
<p>Here, unlike the <a class="reference internal" href="practice_case.html#user-guide-practice-case"><span class="std std-ref">Practice case</span></a>, we have not specified <code class="docutils literal notranslate"><span class="pre">inplace=True</span></code>. By default, this argument is assigned to False, i.e. when the <a class="reference internal" href="../api_reference/smash/smash.Model.run.html#smash.Model.run" title="smash.Model.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.run()</span></code></a> method is called, the model object is not modified in-place but in a copy which can be returned.
So if we display the representation of the model, the last update will still be <code class="docutils literal notranslate"><span class="pre">Initialization</span></code> and no simulated discharge is available.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [58]: </span><span class="n">model</span>
<span class="gh">Out[58]: </span><span class="go"></span>
<span class="go">Model dimension: (time: 1440, nrow: 28, ncol: 28)</span>
<span class="go">Model last update: Initialization</span>

<span class="gp">In [59]: </span><span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">qsim</span>
<span class="gh">Out[59]: </span><span class="go"></span>
<span class="go">array([[-99., -99., -99., ..., -99., -99., -99.],</span>
<span class="go">       [-99., -99., -99., ..., -99., -99., -99.],</span>
<span class="go">       [-99., -99., -99., ..., -99., -99., -99.]], dtype=float32)</span>
</pre></div>
</div>
<p>This argument is useful to keep the original <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> and store the results of the forward run in an other instance.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [60]: </span><span class="n">model_forward</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="gp">In [61]: </span><span class="n">model</span>
<span class="gh">Out[61]: </span><span class="go"></span>
<span class="go">Model dimension: (time: 1440, nrow: 28, ncol: 28)</span>
<span class="go">Model last update: Initialization</span>

<span class="gp">In [62]: </span><span class="n">model_forward</span>
<span class="gh">Out[62]: </span><span class="go"></span>
<span class="go">Model dimension: (time: 1440, nrow: 28, ncol: 28)</span>
<span class="go">Model last update: Forward Run</span>
</pre></div>
</div>
<p>We can visualize the simulated discharges after a forward run for the most downstream gauge.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [63]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model_forward</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">qobs</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observed discharge&quot;</span><span class="p">);</span>

<span class="gp">In [64]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model_forward</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">qsim</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Simulated discharge&quot;</span><span class="p">);</span>

<span class="gp">In [65]: </span><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.7</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">);</span>

<span class="gp">In [66]: </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time step&quot;</span><span class="p">);</span>

<span class="gp">In [67]: </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Discharge $(m^3/s)$&quot;</span><span class="p">);</span>

<span class="gp">In [68]: </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
<img alt="../_images/qsim_fw_rc_user_guide.png" src="../_images/qsim_fw_rc_user_guide.png" />
</div>
<div class="section" id="optimization">
<h3>Optimization<a class="headerlink" href="#optimization" title="Permalink to this heading">#</a></h3>
<p>Let us briefly formulate here the general hydrological model calibration inverse problem. Let <span class="math notranslate nohighlight">\(J \left( \theta \right)\)</span> be a cost function measuring the misfit between simulated and
observed quantities, such as discharge. Note that <span class="math notranslate nohighlight">\(J\)</span> depends on the sought parameter set <span class="math notranslate nohighlight">\(\theta\)</span> throught the hydrological model <span class="math notranslate nohighlight">\(\mathcal{M}\)</span>. An optimal estimate of
<span class="math notranslate nohighlight">\(\hat{\theta}\)</span> of model parameter set is obtained from the condition:</p>
<div class="math notranslate nohighlight">
\[\hat{\theta} = \underset{\theta}{\mathrm{argmin}} \; J\left( \theta \right)\]</div>
<p>Several calibration strategies are available in <a class="reference internal" href="../index.html#module-smash" title="smash"><code class="xref py py-obj docutils literal notranslate"><span class="pre">smash</span></code></a>. They are based on different optimization algorithms and are for example adapted to inverse problems of various complexity, including high dimensional ones.
For the purposes of the user guide, we will only perform a spatially uniform and distributed optimization on the most downstream gauge (TODO ref).</p>
<div class="section" id="spatially-uniform-optimization">
<h4>Spatially uniform optimization<a class="headerlink" href="#spatially-uniform-optimization" title="Permalink to this heading">#</a></h4>
<p>We consider here for optimization:</p>
<ul class="simple">
<li><p>a global minimization algorithm <span class="math notranslate nohighlight">\(\mathrm{SBS}\)</span>,</p></li>
<li><p>a single <span class="math notranslate nohighlight">\(\mathrm{NSE}\)</span> objective function from discharge time series at the most downstream gauge <code class="docutils literal notranslate"><span class="pre">V3524010</span></code>,</p></li>
<li><p>a spatially uniform parameter set <span class="math notranslate nohighlight">\(\theta = \left( \mathrm{cp, cft, lr, exc} \right)^T\)</span> with <span class="math notranslate nohighlight">\(\mathrm{cp}\)</span> being the maximum capacity of the production reservoir, <span class="math notranslate nohighlight">\(\mathrm{cft}\)</span> being the maximum capacity of the transfer reservoir, <span class="math notranslate nohighlight">\(\mathrm{lr}\)</span> being the linear routing parameter and <span class="math notranslate nohighlight">\(\mathrm{exc}\)</span> being the non-conservative exchange parameter.</p></li>
</ul>
<p>Call the <a class="reference internal" href="../api_reference/smash/smash.Model.optimize.html#smash.Model.optimize" title="smash.Model.optimize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.optimize()</span></code></a> method, fill in the arguments <code class="docutils literal notranslate"><span class="pre">algorithm</span></code>, <code class="docutils literal notranslate"><span class="pre">jobs_fun</span></code>, <code class="docutils literal notranslate"><span class="pre">control_vector</span></code> and for the sake of computation time, set the maximum number of iterations in the <code class="docutils literal notranslate"><span class="pre">options</span></code> argument to 2.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [69]: </span><span class="n">model_su</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;sbs&quot;</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">jobs_fun</span><span class="o">=</span><span class="s2">&quot;nse&quot;</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">control_vector</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cp&quot;</span><span class="p">,</span> <span class="s2">&quot;cft&quot;</span><span class="p">,</span> <span class="s2">&quot;lr&quot;</span><span class="p">,</span> <span class="s2">&quot;exc&quot;</span><span class="p">],</span>
<span class="gp">   ....: </span>    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>While the optimization routine is in progress, some information are provided.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;/&gt; Optimize Model J
    Algorithm: &#39;sbs&#39;
    Jobs function: &#39;nse&#39;
    Nx: 1
    Np: 4 [ cp cft exc lr ]
    Ns: 0 [  ]
    Ng: 1 [ V3524010 ]
    wg: 1 [ 1.000000 ]

    At iterate      0    nfg =     1    J =  0.677410    ddx = 0.64
    At iterate      1    nfg =    30    J =  0.130159    ddx = 0.64
    At iterate      2    nfg =    59    J =  0.044362    ddx = 0.32
    STOP: TOTAL NO. OF ITERATION EXCEEDS LIMIT
</pre></div>
</div>
<p>This information is reminiscent of what we have entered in optimization options:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Algorithm</span></code>: the minimization algorithm,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Jobs_fun</span></code>: the objective function,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Nx</span></code>: the dimension of the problem (1 means that we perform a spatially uniform optimization),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Np</span></code>: the number of parameters to optimize and their name,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Ns</span></code>: the number of initial states to optimize and their name,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Ng</span></code>: the number of gauges to optimize and their code/name,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wg</span></code>: the weight assigned to each optimized gauge.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The size of the control vector is defined by <span class="math notranslate nohighlight">\(Nx \left(Np + Ns \right)\)</span></p>
</div>
<p>Then, for each iteration, we can retrieve:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nfg</span></code>: the total number of function and gradient evaluations (there is no gradient evaluations in the minimization algorithm <span class="math notranslate nohighlight">\(\mathrm{SBS}\)</span>),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">J</span></code>: the value of the cost function,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ddx</span></code>: the convergence criterion specific to the minimization algorithm <span class="math notranslate nohighlight">\(\mathrm{SBS}\)</span> (the algorithm converges when <code class="docutils literal notranslate"><span class="pre">ddx</span></code> is lower than 0.01).</p></li>
</ul>
<p>The last line informs about the reason why the optimization ended. Here, since we have forced 2 iterations maximum, the algorithm stopped because the number of iterations was exceeded.</p>
<p>Once the optimization is complete. We can visualize the simulated discharge,</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [70]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model_su</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">qobs</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observed discharge&quot;</span><span class="p">);</span>

<span class="gp">In [71]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model_su</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">qsim</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Simulated discharge&quot;</span><span class="p">);</span>

<span class="gp">In [72]: </span><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.7</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">);</span>

<span class="gp">In [73]: </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time step&quot;</span><span class="p">);</span>

<span class="gp">In [74]: </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Discharge $(m^3/s)$&quot;</span><span class="p">);</span>

<span class="gp">In [75]: </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
<img alt="../_images/qsim_su_rc_user_guide.png" src="../_images/qsim_su_rc_user_guide.png" />
<p>The cost function value <span class="math notranslate nohighlight">\(J\)</span> (should be equal to the last iteration <code class="docutils literal notranslate"><span class="pre">J</span></code>),</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [76]: </span><span class="n">model_su</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">cost</span>
<span class="gh">Out[76]: </span><span class="go">0.0443621501326561</span>
</pre></div>
</div>
<p>The optimized parameters <span class="math notranslate nohighlight">\(\hat{\theta}\)</span> (for the sake of clarity and because we performed a spatially uniform optimization, we will only display the parameter set values for one cell wihtin the catchment active cells, which is the most downstream gauge position here),</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [77]: </span><span class="p">(</span>
<span class="gp">   ....: </span> <span class="n">model_su</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">cp</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">27</span><span class="p">],</span>
<span class="gp">   ....: </span> <span class="n">model_su</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">cft</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">27</span><span class="p">],</span>
<span class="gp">   ....: </span> <span class="n">model_su</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">lr</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">27</span><span class="p">],</span>
<span class="gp">   ....: </span> <span class="n">model_su</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">exc</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">27</span><span class="p">],</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>
<span class="gh">Out[77]: </span><span class="go">(76.57858, 263.64627, 34.10478, -0.6028207)</span>
</pre></div>
</div>
</div>
<div class="section" id="spatially-distributed-optimization">
<h4>Spatially distributed optimization<a class="headerlink" href="#spatially-distributed-optimization" title="Permalink to this heading">#</a></h4>
<p>We consider here for optimization:</p>
<ul class="simple">
<li><p>a gradient descent minimization algorithm <span class="math notranslate nohighlight">\(\mathrm{L}\text{-}\mathrm{BFGS}\text{-}\mathrm{B}\)</span>,</p></li>
<li><p>a single <span class="math notranslate nohighlight">\(\mathrm{NSE}\)</span> objective function from discharge time series at the most downstream gauge <code class="docutils literal notranslate"><span class="pre">V3524010</span></code>,</p></li>
<li><p>a spatially distributed parameter set <span class="math notranslate nohighlight">\(\theta = \left( \mathrm{cp, cft, lr, exc} \right)^T\)</span> with <span class="math notranslate nohighlight">\(\mathrm{cp}\)</span> being the maximum capacity of the production reservoir, <span class="math notranslate nohighlight">\(\mathrm{cft}\)</span> being the maximum capacity of the transfer reservoir, <span class="math notranslate nohighlight">\(\mathrm{lr}\)</span> being the linear routing parameter and <span class="math notranslate nohighlight">\(\mathrm{exc}\)</span> being the non-conservative exchange parameter.</p></li>
<li><p>a prior set of parameters <span class="math notranslate nohighlight">\(\bar{\theta}^*\)</span> generated from the previous spatially uniform global optimization.</p></li>
</ul>
<p>Call the <a class="reference internal" href="../api_reference/smash/smash.Model.optimize.html#smash.Model.optimize" title="smash.Model.optimize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.optimize()</span></code></a> method, fill in the arguments <code class="docutils literal notranslate"><span class="pre">algorithm</span></code>, <code class="docutils literal notranslate"><span class="pre">jobs_fun</span></code>, <code class="docutils literal notranslate"><span class="pre">control_vector</span></code> and for the sake of computation time, set the maximum number of iterations in the <code class="docutils literal notranslate"><span class="pre">options</span></code> argument to 10.</p>
<p>As we run this optimization from the previously generated uniform parameter set, we apply the <a class="reference internal" href="../api_reference/smash/smash.Model.optimize.html#smash.Model.optimize" title="smash.Model.optimize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.optimize()</span></code></a> method from the <code class="docutils literal notranslate"><span class="pre">model_su</span></code> instance which had stored the previous optimized parameters.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [78]: </span><span class="n">model_sd</span> <span class="o">=</span> <span class="n">model_su</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;l-bfgs-b&quot;</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">jobs_fun</span><span class="o">=</span><span class="s2">&quot;nse&quot;</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">control_vector</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cp&quot;</span><span class="p">,</span> <span class="s2">&quot;cft&quot;</span><span class="p">,</span> <span class="s2">&quot;lr&quot;</span><span class="p">,</span> <span class="s2">&quot;exc&quot;</span><span class="p">],</span>
<span class="gp">   ....: </span>    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>While the optimization routine is in progress, some information are provided.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;/&gt; Optimize Model J
    Algorithm: &#39;l-bfgs-b&#39;
    Jobs function: &#39;nse&#39;
    Jreg function: &#39;prior&#39;
    wJreg: .000000
    Nx: 383
    Np: 4 [ cp cft exc lr ]
    Ns: 0 [  ]
    Ng: 1 [ V3524010 ]
    wg: 1 [ 1.000000 ]

    At iterate      0    nfg =     1    J =  0.044362    |proj g| =  0.000000
    At iterate      1    nfg =     2    J =  0.044120    |proj g| =  0.000144
    At iterate      2    nfg =     3    J =  0.039256    |proj g| =  0.000075
    At iterate      3    nfg =     4    J =  0.038600    |proj g| =  0.000088
    At iterate      4    nfg =     5    J =  0.035663    |proj g| =  0.000019
    At iterate      5    nfg =     7    J =  0.034913    |proj g| =  0.000011
    At iterate      6    nfg =     8    J =  0.033650    |proj g| =  0.000010
    At iterate      7    nfg =     9    J =  0.032127    |proj g| =  0.000013
    At iterate      8    nfg =    10    J =  0.031194    |proj g| =  0.000011
    At iterate      9    nfg =    11    J =  0.028002    |proj g| =  0.000085
    At iterate     10    nfg =    12    J =  0.027122    |proj g| =  0.000024
    STOP: TOTAL NO. OF ITERATION EXCEEDS LIMIT
</pre></div>
</div>
<p>The information are broadly similar to the spatially uniform optimization, except for</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Jreg_function</span></code>: the regularization function,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wJreg</span></code>: the weight assigned to the regularization term,</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We did not specified any regularization options. Therefore, the <code class="docutils literal notranslate"><span class="pre">wJreg</span></code> term is set to 0 and no regularization is applied to the optimization.</p>
</div>
<p>Then, for each iteration, we can retrieve same information with <code class="docutils literal notranslate"><span class="pre">nfg</span></code> (there are gradients evaluations for the <span class="math notranslate nohighlight">\(\mathrm{L}\text{-}\mathrm{BFGS}\text{-}\mathrm{B}\)</span> algorithm) and <code class="docutils literal notranslate"><span class="pre">J</span></code>.
<code class="docutils literal notranslate"><span class="pre">|proj</span> <span class="pre">g|</span></code> is the infinity norm of the projected gradient.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The cost function <span class="math notranslate nohighlight">\(J\)</span> at 0<sup>th</sup> iteration is equal to the cost function at the end of the spatially uniform optimization. This means that we used the previous optimized parameters as new prior.</p>
</div>
<p>The algorithm also stopped because the number of iterations was exceeded.</p>
<p>We can once again visualize, the simulated discharges (<code class="docutils literal notranslate"><span class="pre">su</span></code>: spatially uniform, <code class="docutils literal notranslate"><span class="pre">sd</span></code>: spatially distributed)</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [79]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model_sd</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">qobs</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observed discharge&quot;</span><span class="p">);</span>

<span class="gp">In [80]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model_su</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">qsim</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Simulated discharge - su&quot;</span><span class="p">);</span>

<span class="gp">In [81]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model_sd</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">qsim</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Simulated discharge - sd&quot;</span><span class="p">);</span>

<span class="gp">In [82]: </span><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.7</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">);</span>

<span class="gp">In [83]: </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time step&quot;</span><span class="p">);</span>

<span class="gp">In [84]: </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Discharge $(m^3/s)$&quot;</span><span class="p">);</span>

<span class="gp">In [85]: </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
<img alt="../_images/qsim_sd_rc_user_guide.png" src="../_images/qsim_sd_rc_user_guide.png" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The difference between the two simulated discharges is very slight. Indeed, the spatially uniform optimization already leads to rather good performances with a cost function <span class="math notranslate nohighlight">\(J\)</span> equal to 0.04.
Spatially distributed optimization only improved the performances by approximately 0.02.</p>
</div>
<p>The cost function value <span class="math notranslate nohighlight">\(J\)</span>,</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [86]: </span><span class="n">model_sd</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">cost</span>
<span class="gh">Out[86]: </span><span class="go">0.027122236788272858</span>
</pre></div>
</div>
<p>The optimized parameters <span class="math notranslate nohighlight">\(\hat{\theta}\)</span>,</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [87]: </span><span class="n">ma</span> <span class="o">=</span> <span class="p">(</span><span class="n">model_sd</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">active_cell</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

<span class="gp">In [88]: </span><span class="n">ma_cp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ma</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">model_sd</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">cp</span><span class="p">)</span>

<span class="gp">In [89]: </span><span class="n">ma_cft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ma</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">model_sd</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">cft</span><span class="p">)</span>

<span class="gp">In [90]: </span><span class="n">ma_lr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ma</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">model_sd</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">lr</span><span class="p">)</span>

<span class="gp">In [91]: </span><span class="n">ma_exc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ma</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">model_sd</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">exc</span><span class="p">)</span>

<span class="gp">In [92]: </span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="gp">In [93]: </span><span class="n">map_cp</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ma_cp</span><span class="p">);</span>

<span class="gp">In [94]: </span><span class="n">f</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">map_cp</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cp (mm)&quot;</span><span class="p">);</span>

<span class="gp">In [95]: </span><span class="n">map_cft</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ma_cft</span><span class="p">);</span>

<span class="gp">In [96]: </span><span class="n">f</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">map_cft</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cft (mm)&quot;</span><span class="p">);</span>

<span class="gp">In [97]: </span><span class="n">map_lr</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ma_lr</span><span class="p">);</span>

<span class="gp">In [98]: </span><span class="n">f</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">map_lr</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;lr (min)&quot;</span><span class="p">);</span>

<span class="gp">In [99]: </span><span class="n">map_exc</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ma_exc</span><span class="p">);</span>

<span class="gp">In [100]: </span><span class="n">f</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">map_exc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;exc (mm/h)&quot;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../_images/theta_sd_rc_user_guide.png" src="../_images/theta_sd_rc_user_guide.png" />
</div>
</div>
</div>
<div class="section" id="getting-data">
<h2>Getting data<a class="headerlink" href="#getting-data" title="Permalink to this heading">#</a></h2>
<p>Finally and as a remainder of the <a class="reference internal" href="practice_case.html#user-guide-practice-case"><span class="std std-ref">Practice case</span></a>, it is possible to save any <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> object to HDF5. Here, we will save both optimized instances.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [101]: </span><span class="n">smash</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="n">model_su</span><span class="p">,</span> <span class="s2">&quot;su_optimize_Cance.hdf5&quot;</span><span class="p">)</span>

<span class="gp">In [102]: </span><span class="n">smash</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="n">model_sd</span><span class="p">,</span> <span class="s2">&quot;sd_optimize_Cance.hdf5&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>And reload them as follows</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [103]: </span><span class="n">model_su_reloaded</span> <span class="o">=</span> <span class="n">smash</span><span class="o">.</span><span class="n">read_model</span><span class="p">(</span><span class="s2">&quot;su_optimize_Cance.hdf5&quot;</span><span class="p">)</span>

<span class="gp">In [104]: </span><span class="n">model_sd_reloaded</span> <span class="o">=</span> <span class="n">smash</span><span class="o">.</span><span class="n">read_model</span><span class="p">(</span><span class="s2">&quot;sd_optimize_Cance.hdf5&quot;</span><span class="p">)</span>

<span class="gp">In [105]: </span><span class="n">model_su</span><span class="p">,</span> <span class="n">model_su_reloaded</span>
<span class="gh">Out[105]: </span><span class="go"></span>
<span class="go">(Model dimension: (time: 1440, nrow: 28, ncol: 28)</span>
<span class="go"> Model last update: Step By Step Optimization,</span>
<span class="go"> Model dimension: (time: 1440, nrow: 28, ncol: 28)</span>
<span class="go"> Model last update: Step By Step Optimization)</span>

<span class="gp">In [106]: </span><span class="n">model_sd</span><span class="p">,</span> <span class="n">model_sd_reloaded</span>
<span class="gh">Out[106]: </span><span class="go"></span>
<span class="go">(Model dimension: (time: 1440, nrow: 28, ncol: 28)</span>
<span class="go"> Model last update: L-BFGS-B Optimization,</span>
<span class="go"> Model dimension: (time: 1440, nrow: 28, ncol: 28)</span>
<span class="go"> Model last update: L-BFGS-B Optimization)</span>
</pre></div>
</div>
</div>
</div>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="practice_case.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Practice case</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="model_initialization.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Model initialization</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-object-creation">
   Model object creation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup-argument">
     Setup argument
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#input-data-files-structure">
     Input data files structure
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#observed-dicharge">
       Observed dicharge
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#precipitation">
       Precipitation
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#potential-evapotranspiration">
       Potential evapotranspiration
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mesh-argument">
     Mesh argument
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mesh-composition">
       Mesh composition
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#generate-a-mesh-automatically">
       Generate a mesh automatically
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#viewing-model">
   Viewing Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#input-data-observed-discharge">
     Input Data - Observed discharge
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#input-data-atmospheric-forcings">
     Input Data - Atmospheric forcings
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run">
   Run
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#forward-run">
     Forward run
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimization">
     Optimization
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spatially-uniform-optimization">
       Spatially uniform optimization
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spatially-distributed-optimization">
       Spatially distributed optimization
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#getting-data">
   Getting data
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../_sources/user_guide/real_case_cance.rst.txt">
        <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1e1de1a1873e13ef5536"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2022, Francois Colleoni.<br>

</p>

  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.0.0+.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>