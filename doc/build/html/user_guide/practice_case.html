
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Practice case &#8212; smash 0.1.0 documentation</title>
  <script>
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1e1de1a1873e13ef5536" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1e1de1a1873e13ef5536" rel="stylesheet">

  
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/6.1.2/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/smash.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1e1de1a1873e13ef5536">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/practice_case';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Real case - Cance" href="real_case_cance.html" />
    <link rel="prev" title="User guide" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="light">

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
    <img src="../_static/logo_smash.svg" class="logo__image only-light" alt="Logo image">
    <img src="../_static/logo_smash.svg" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../getting_started/index.html">
                        Getting started
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="index.html">
                        User guide
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../api_reference/index.html">
                        API Reference
                    </a>
                </li>
                
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      <div class="navbar-end-item navbar-end__search-button-container">
        
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
      </div>
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" data-toggle="tooltip">
    <a class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="fa-regular fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://gitlab.irstea.fr/francois.colleoni/smash/" title="GitLab" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-gitlab"></i></span>
            <label class="sr-only">GitLab</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>


  
  <div class="search-button-container--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
  </div>

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../getting_started/index.html">
                        Getting started
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="index.html">
                        User guide
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../api_reference/index.html">
                        API Reference
                    </a>
                </li>
                
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" data-toggle="tooltip">
    <a class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="fa-regular fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://gitlab.irstea.fr/francois.colleoni/smash/" title="GitLab" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-gitlab"></i></span>
            <label class="sr-only">GitLab</label></a>
        </li>
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
  <p class="bd-links__title" role="heading" aria-level="1">
    Section Navigation
  </p>
  <div class="bd-toc-item navbar-nav">
    <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Practice case</a></li>
<li class="toctree-l1"><a class="reference internal" href="real_case_cance.html">Real case - Cance</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_initialization.html">Model initialization</a></li>
</ul>

  </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

      </div>
      <main class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <div class="section" id="practice-case">
<span id="user-guide-practice-case"></span><h1>Practice case<a class="headerlink" href="#practice-case" title="Permalink to this heading">#</a></h1>
<p>The Practice case is an introduction to <a class="reference internal" href="../index.html#module-smash" title="smash"><code class="xref py py-obj docutils literal notranslate"><span class="pre">smash</span></code></a> for new users. The objective of this section is to create the dataset to run <a class="reference internal" href="../index.html#module-smash" title="smash"><code class="xref py py-obj docutils literal notranslate"><span class="pre">smash</span></code></a> from scratch and get an overview of what is available. More details are provided on a real case available in the User Guide section: <a class="reference internal" href="real_case_cance.html#user-guide-real-case-cance"><span class="std std-ref">Real case - Cance</span></a>.</p>
<p>For this case, a fictitious square-shaped catchment of size 10 x 10 km² will be created with the following drained area and flow directions:</p>
<a class="reference internal image-reference" href="../_images/flwdir_da_Practice_case.png"><img alt="../_images/flwdir_da_Practice_case.png" class="align-center" src="../_images/flwdir_da_Practice_case.png" style="width: 750px;" /></a>
<p>First, open a Python interface:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>python3
</pre></div>
</div>
<div class="section" id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h2>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">smash</span>

<span class="gp">In [2]: </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="gp">In [3]: </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul class="simple">
<li><p>The wrapping of Fortran code in Python requires the use of the <a class="reference external" href="https://github.com/jameskermode/f90wrap">f90wrap</a> package, which itself uses <a class="reference external" href="https://numpy.org/doc/stable/f2py/">f2py</a>. Thus, the <a class="reference external" href="https://numpy.org/">NumPy</a> package is essential in the management of arguments/tables. A knowledge of this package is advised in the use of <a class="reference internal" href="../index.html#module-smash" title="smash"><code class="xref py py-obj docutils literal notranslate"><span class="pre">smash</span></code></a>.</p></li>
<li><p>The <a class="reference external" href="https://matplotlib.org/">Matplotlib</a> package is the visualization package used in the <a class="reference internal" href="../index.html#module-smash" title="smash"><code class="xref py py-obj docutils literal notranslate"><span class="pre">smash</span></code></a> documentation but any tool can be used.</p></li>
</ul>
</div>
</div>
<div class="section" id="model-object-creation">
<h2>Model object creation<a class="headerlink" href="#model-object-creation" title="Permalink to this heading">#</a></h2>
<p>Creating a <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> requires two input arguments: <code class="docutils literal notranslate"><span class="pre">setup</span></code> and <code class="docutils literal notranslate"><span class="pre">mesh</span></code>.</p>
<div class="section" id="setup-argument-creation">
<span id="practice-case-setup-argument-creation"></span><h3>Setup argument creation<a class="headerlink" href="#setup-argument-creation" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">setup</span></code> is a dictionary that allows to initialize <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> (i.e. allocate the necessary setup Fortran arrays).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Each key and associated values that can be passed into the <code class="docutils literal notranslate"><span class="pre">setup</span></code> dictionary are detailed in the User Guide section: <a class="reference internal" href="model_initialization.html#user-guide-model-initialization-setup"><span class="std std-ref">Model initialization</span></a>.</p>
</div>
<p>A minimal <code class="docutils literal notranslate"><span class="pre">setup</span></code> configuration is:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dt</span></code>: the calculation time step in s,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">start_time</span></code>: the beginning of the simulation,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">end_time</span></code>: the end of the simulation.</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="n">setup</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">   ...: </span>    <span class="s2">&quot;dt&quot;</span><span class="p">:</span> <span class="mi">3_600</span><span class="p">,</span>
<span class="gp">   ...: </span>    <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-01-01 00:00&quot;</span><span class="p">,</span>
<span class="gp">   ...: </span>    <span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-01-04 00:00&quot;</span><span class="p">,</span>
<span class="gp">   ...: </span><span class="p">}</span>
<span class="gp">   ...: </span>
</pre></div>
</div>
</div>
<div class="section" id="mesh-argument-creation">
<span id="practice-case-mesh-argument-creation"></span><h3>Mesh argument creation<a class="headerlink" href="#mesh-argument-creation" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">mesh</span></code> is a dictionary that allows to initialize <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> (i.e. allocate the necessary mesh Fortran arrays).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Each key and associated values that can be passed into the <code class="docutils literal notranslate"><span class="pre">mesh</span></code> dictionary are detailed in the User Guide section: <a class="reference internal" href="model_initialization.html#user-guide-model-initialization-mesh"><span class="std std-ref">Model initialization</span></a>.</p></li>
<li><p>In the Practice case, because the catchment is ficticious, we create the <code class="docutils literal notranslate"><span class="pre">mesh</span></code> dictionary ourselves. In the case of a real catchment, the meshing generation can be done automatically via the meshing method <a class="reference internal" href="../api_reference/smash/smash.generate_mesh.html#smash.generate_mesh" title="smash.generate_mesh"><code class="xref py py-meth docutils literal notranslate"><span class="pre">smash.generate_mesh()</span></code></a>. More details can be found in the User Guide section: <a class="reference internal" href="real_case_cance.html#user-guide-real-case-cance"><span class="std std-ref">Real case - Cance</span></a>.</p></li>
</ul>
</div>
<p>First part of  <code class="docutils literal notranslate"><span class="pre">mesh</span></code> configuration is:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dx</span></code>: the calculation spatial step in m,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nrow</span></code>: the number of rows,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ncol</span></code>: the number of columns,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ng</span></code>: the number of gauges,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nac</span></code>: the number of cells that contribute to any gauge discharge (here the full grid contributes),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">area</span></code>: the catchment area in m²,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gauge_pos</span></code>: the gauge position in the grid (it must follow <strong>Fortran indexing</strong>).</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="n">dx</span> <span class="o">=</span> <span class="mi">1_000</span>

<span class="gp">In [6]: </span><span class="p">(</span><span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="gp">In [7]: </span><span class="n">mesh</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">   ...: </span>    <span class="s2">&quot;dx&quot;</span><span class="p">:</span> <span class="n">dx</span><span class="p">,</span>
<span class="gp">   ...: </span>    <span class="s2">&quot;nrow&quot;</span><span class="p">:</span> <span class="n">nrow</span><span class="p">,</span>
<span class="gp">   ...: </span>    <span class="s2">&quot;ncol&quot;</span><span class="p">:</span> <span class="n">ncol</span><span class="p">,</span>
<span class="gp">   ...: </span>    <span class="s2">&quot;ng&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="gp">   ...: </span>    <span class="s2">&quot;nac&quot;</span><span class="p">:</span> <span class="n">nrow</span> <span class="o">*</span> <span class="n">ncol</span><span class="p">,</span>
<span class="gp">   ...: </span>    <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="n">nrow</span> <span class="o">*</span> <span class="n">ncol</span> <span class="o">*</span> <span class="p">(</span><span class="n">dx</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
<span class="gp">   ...: </span>    <span class="s2">&quot;gauge_pos&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
<span class="gp">   ...: </span><span class="p">}</span>
<span class="gp">   ...: </span>
</pre></div>
</div>
<p>Second part of <code class="docutils literal notranslate"><span class="pre">mesh</span></code> configuration is:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">flwdir</span></code>: the flow directions,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">drained_area</span></code>: the drained area in number of cells.</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;flwdir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<span class="gp">   ...: </span>    <span class="p">[</span>
<span class="gp">   ...: </span>    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
<span class="gp">   ...: </span>    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
<span class="gp">   ...: </span>    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
<span class="gp">   ...: </span>    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
<span class="gp">   ...: </span>    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
<span class="gp">   ...: </span>    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
<span class="gp">   ...: </span>    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
<span class="gp">   ...: </span>    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
<span class="gp">   ...: </span>    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
<span class="gp">   ...: </span>    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
<span class="gp">   ...: </span>    <span class="p">],</span>
<span class="gp">   ...: </span>    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
<span class="gp">   ...: </span><span class="p">)</span>
<span class="gp">   ...: </span>

<span class="gp">In [9]: </span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;drained_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<span class="gp">   ...: </span>    <span class="p">[</span>
<span class="gp">   ...: </span>           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">   ...: </span>           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<span class="gp">   ...: </span>           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<span class="gp">   ...: </span>           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
<span class="gp">   ...: </span>           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
<span class="gp">   ...: </span>           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
<span class="gp">   ...: </span>           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
<span class="gp">   ...: </span>           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
<span class="gp">   ...: </span>           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
<span class="gp">   ...: </span>           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
<span class="gp">   ...: </span>        <span class="p">],</span>
<span class="gp">   ...: </span>        <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
<span class="gp">   ...: </span>    <span class="p">)</span>
<span class="gp">   ...: </span>
</pre></div>
</div>
<p>Finally, the calculation path (<code class="docutils literal notranslate"><span class="pre">path</span></code>) must be provided (ascending order of drained area). This can be directly computed from <code class="docutils literal notranslate"><span class="pre">drained_area</span></code> and NumPy methods (it must follow <strong>Fortran indexing</strong>).</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="n">ind_path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;drained_area&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
<span class="gp">   ....: </span>     <span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;drained_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [11]: </span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;drained_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
<span class="gp">   ....: </span>    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [12]: </span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ind_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

<span class="gp">In [13]: </span><span class="n">mesh</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ind_path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Once <code class="docutils literal notranslate"><span class="pre">setup</span></code> and <code class="docutils literal notranslate"><span class="pre">mesh</span></code> are filled in, a <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> object can be created:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [14]: </span><span class="n">model</span> <span class="o">=</span> <span class="n">smash</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>

<span class="gp">In [15]: </span><span class="n">model</span>
<span class="gh">Out[15]: </span><span class="go"></span>
<span class="go">Model dimension: (time: 72, nrow: 10, ncol: 10)</span>
<span class="go">Model last update: Initialization</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The representation of the <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> object is very simple and only displays the dimensions and the last action that updated the object. More information on what the object contains is available below.</p>
</div>
</div>
</div>
<div class="section" id="viewing-model">
<h2>Viewing Model<a class="headerlink" href="#viewing-model" title="Permalink to this heading">#</a></h2>
<p>Once the <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> object is created, it is possible to visualize what it contains through 6 attributes. This 6 attributes are Python classes that are derived from the wrapping of Fortran derived types.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See details in the <a class="reference internal" href="../api_reference/index.html#api-reference"><span class="std std-ref">API Reference</span></a> for the attributes:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api_reference/smash/smash.Model.setup.html#smash.Model.setup" title="smash.Model.setup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.setup</span></code></a></p></li>
<li><p><a class="reference internal" href="../api_reference/smash/smash.Model.mesh.html#smash.Model.mesh" title="smash.Model.mesh"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.mesh</span></code></a></p></li>
<li><p><a class="reference internal" href="../api_reference/smash/smash.Model.input_data.html#smash.Model.input_data" title="smash.Model.input_data"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.input_data</span></code></a></p></li>
<li><p><a class="reference internal" href="../api_reference/smash/smash.Model.parameters.html#smash.Model.parameters" title="smash.Model.parameters"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.parameters</span></code></a></p></li>
<li><p><a class="reference internal" href="../api_reference/smash/smash.Model.states.html#smash.Model.states" title="smash.Model.states"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.states</span></code></a></p></li>
<li><p><a class="reference internal" href="../api_reference/smash/smash.Model.output.html#smash.Model.output" title="smash.Model.output"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.output</span></code></a></p></li>
</ul>
</div>
<div class="section" id="setup">
<h3>Setup<a class="headerlink" href="#setup" title="Permalink to this heading">#</a></h3>
<p>The <a class="reference internal" href="../api_reference/smash/smash.Model.setup.html#smash.Model.setup" title="smash.Model.setup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.setup</span></code></a> attribute contains a set of arguments necessary to initialize the <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a>. We have in the <a class="reference internal" href="#practice-case-setup-argument-creation"><span class="std std-ref">Setup argument creation</span></a> part given values for the arguments <code class="docutils literal notranslate"><span class="pre">dt</span></code>, <code class="docutils literal notranslate"><span class="pre">start_time</span></code> and <code class="docutils literal notranslate"><span class="pre">end_time</span></code>. These values can be retrieved in the following way:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [16]: </span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">end_time</span>
<span class="gh">Out[16]: </span><span class="go">(3600.0, b&#39;2020-01-01 00:00&#39;, b&#39;2020-01-04 00:00&#39;)</span>
</pre></div>
</div>
<p>The other <a class="reference internal" href="../api_reference/smash/smash.Model.setup.html#smash.Model.setup" title="smash.Model.setup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.setup</span></code></a> arguments can also be viewed even if they have not been directly defined in the <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> initialization. These arguments have default values in the code:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [17]: </span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">production_module</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">routing_module</span>
<span class="gh">Out[17]: </span><span class="go">(0, 0)</span>
</pre></div>
</div>
<p>If you are using IPython, tab completion allows you to visualize all the attributes and methods:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [18]: </span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.&lt;</span><span class="n">TAB</span><span class="o">&gt;</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>                   <span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">prcp_directory</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">daily_interannual_pet</span>   <span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">prcp_format</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">descriptor_directory</span>    <span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">prcp_indice</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">descriptor_format</span>       <span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">production_module</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">descriptor_name</span>         <span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">qobs_directory</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">dt</span>                      <span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">read_descriptor</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">end_time</span>                <span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">read_pet</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">exchange_module</span>         <span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">read_prcp</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">from_handle</span><span class="p">(</span>            <span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">read_qobs</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">interception_module</span>     <span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">routing_module</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">mean_forcing</span>            <span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">save_qsim_domain</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">pet_conversion_factor</span>   <span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">sparse_storage</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">pet_directory</span>           <span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">start_time</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">pet_format</span>              <span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">transfer_module</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">prcp_conversion_factor</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
</div>
<div class="section" id="mesh">
<h3>Mesh<a class="headerlink" href="#mesh" title="Permalink to this heading">#</a></h3>
<p>The <a class="reference internal" href="../api_reference/smash/smash.Model.mesh.html#smash.Model.mesh" title="smash.Model.mesh"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.mesh</span></code></a> attribute contains a set of arguments necessary to initialize the <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a>. We have in the <a class="reference internal" href="#practice-case-mesh-argument-creation"><span class="std std-ref">Mesh argument creation</span></a> part given values for multiple arguments. These values can be retrieved in the following way:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [19]: </span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">nrow</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">ncol</span>
<span class="gh">Out[19]: </span><span class="go">(1000.0, 10, 10)</span>
</pre></div>
</div>
<p>NumPy array can also be viewed:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [20]: </span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">drained_area</span>
<span class="gh">Out[20]: </span><span class="go"></span>
<span class="go">array([[  1,   1,   1,   1,   1,   1,   1,   1,   1,   1],</span>
<span class="go">       [  1,   4,   2,   2,   2,   2,   2,   2,   2,   2],</span>
<span class="go">       [  1,   2,   9,   3,   3,   3,   3,   3,   3,   3],</span>
<span class="go">       [  1,   2,   3,  16,   4,   4,   4,   4,   4,   4],</span>
<span class="go">       [  1,   2,   3,   4,  25,   5,   5,   5,   5,   5],</span>
<span class="go">       [  1,   2,   3,   4,   5,  36,   6,   6,   6,   6],</span>
<span class="go">       [  1,   2,   3,   4,   5,   6,  49,   7,   7,   7],</span>
<span class="go">       [  1,   2,   3,   4,   5,   6,   7,  64,   8,   8],</span>
<span class="go">       [  1,   2,   3,   4,   5,   6,   7,   8,  81,   9],</span>
<span class="go">       [  1,   2,   3,   4,   5,   6,   7,   8,   9, 100]], dtype=int32)</span>
</pre></div>
</div>
<p>Or plotted using Matplotlib.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [21]: </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">drained_area</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Spectral&quot;</span><span class="p">);</span>

<span class="gp">In [22]: </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Number of cells&quot;</span><span class="p">);</span>

<span class="gp">In [23]: </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Practice case - Drained Area&quot;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../_images/da_pc_user_guide.png" src="../_images/da_pc_user_guide.png" />
<p>If you are using IPython, tab completion allows you to visualize all the attributes and methods:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [24]: </span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.&lt;</span><span class="n">TAB</span><span class="o">&gt;</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">active_cell</span>   <span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">gauge_pos</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">area</span>          <span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">nac</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">code</span>          <span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">ncol</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>         <span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">ng</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">drained_area</span>  <span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">nrow</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">dx</span>            <span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">path</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">flwdir</span>        <span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">xmin</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">flwdst</span>        <span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">ymax</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">from_handle</span><span class="p">(</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
</div>
<div class="section" id="input-data">
<h3>Input Data<a class="headerlink" href="#input-data" title="Permalink to this heading">#</a></h3>
<p>The <a class="reference internal" href="../api_reference/smash/smash.Model.input_data.html#smash.Model.input_data" title="smash.Model.input_data"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.input_data</span></code></a> attribute contains a set of arguments storing <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> input data (i.e. atmospheric forcings, observed discharge …). As we did not specify in the <a class="reference internal" href="#practice-case-setup-argument-creation"><span class="std std-ref">Setup argument creation</span></a> part a reading of input data, all tables are empty but allocated according to the size of the grid and the simulation period.</p>
<p>For example, the observed discharge is a NumPy array of shape (1, 72). There is 1 gauge in the grid and the simulation period is up to 72 time steps. The value -99 indicates no data.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [25]: </span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">qobs</span>
<span class="gh">Out[25]: </span><span class="go"></span>
<span class="go">array([[-99., -99., -99., -99., -99., -99., -99., -99., -99., -99., -99.,</span>
<span class="go">        -99., -99., -99., -99., -99., -99., -99., -99., -99., -99., -99.,</span>
<span class="go">        -99., -99., -99., -99., -99., -99., -99., -99., -99., -99., -99.,</span>
<span class="go">        -99., -99., -99., -99., -99., -99., -99., -99., -99., -99., -99.,</span>
<span class="go">        -99., -99., -99., -99., -99., -99., -99., -99., -99., -99., -99.,</span>
<span class="go">        -99., -99., -99., -99., -99., -99., -99., -99., -99., -99., -99.,</span>
<span class="go">        -99., -99., -99., -99., -99., -99.]], dtype=float32)</span>

<span class="gp">In [26]: </span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">qobs</span><span class="o">.</span><span class="n">shape</span>
<span class="gh">Out[26]: </span><span class="go">(1, 72)</span>
</pre></div>
</div>
<p>Precipitation is also a NumPy array but of shape (10, 10, 72). The number of rows and columns is 10 and same as the observed dicharge, the simulation period is up to 72 time steps.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [27]: </span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">prcp</span><span class="o">.</span><span class="n">shape</span>
<span class="gh">Out[27]: </span><span class="go">(10, 10, 72)</span>
</pre></div>
</div>
<p>If you are using IPython, tab completion allows you to visualize all the attributes and methods:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [28]: </span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.&lt;</span><span class="n">TAB</span><span class="o">&gt;</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>         <span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">prcp</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">descriptor</span>    <span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">prcp_indice</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">from_handle</span><span class="p">(</span>  <span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">qobs</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">mean_pet</span>      <span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">sparse_pet</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">mean_prcp</span>     <span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">sparse_prcp</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">pet</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It can happen, depending on the <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> initialization, that some arguments of type NumPy array are not accessible (unallocated array in the Fortran code). For example, we did not ask in the <code class="docutils literal notranslate"><span class="pre">setup</span></code> to calculate the spatial average of precipitation. Access to this variable is therefore impossible and the code will return the following error:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [29]: </span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">mean_prcp</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">29</span><span class="o">-</span><span class="mi">1</span><span class="n">edba9689818</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">mean_prcp</span>

<span class="nn">~/Documents/distant/misc/smash/smash/solver/_mwd_input_data.py</span> in <span class="ni">mean_prcp</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">654</span>             <span class="n">mean_prcp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrays</span><span class="p">[</span><span class="n">array_handle</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">655</span>         <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">656</span>             <span class="n">mean_prcp</span> <span class="o">=</span> <span class="n">f90wrap</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="n">f90wrap</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">sizeof_fortran_t</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">657</span>                                     <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">658</span>                                     <span class="n">_solver</span><span class="o">.</span><span class="n">f90wrap_input_datadt__array__mean_prcp</span><span class="p">)</span>

<span class="ne">ValueError</span>: array is NULL
</pre></div>
</div>
</div>
</div>
<div class="section" id="parameters-and-states">
<h3>Parameters and States<a class="headerlink" href="#parameters-and-states" title="Permalink to this heading">#</a></h3>
<p>The <a class="reference internal" href="../api_reference/smash/smash.Model.parameters.html#smash.Model.parameters" title="smash.Model.parameters"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.parameters</span></code></a> and <a class="reference internal" href="../api_reference/smash/smash.Model.states.html#smash.Model.states" title="smash.Model.states"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.states</span></code></a> attributes contain a set of arguments storing <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> parameters and states. This attributes contain only NumPy arrays of shape (10, 10) (i.e. number of rows and columns in the grid).</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [30]: </span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">hp</span><span class="o">.</span><span class="n">shape</span>
<span class="gh">Out[30]: </span><span class="go">((10, 10), (10, 10))</span>
</pre></div>
</div>
<p>This arrays are filled in with uniform default values.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [31]: </span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">cp</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">hp</span>
<span class="gh">Out[31]: </span><span class="go"></span>
<span class="go">(array([[200., 200., 200., 200., 200., 200., 200., 200., 200., 200.],</span>
<span class="go">        [200., 200., 200., 200., 200., 200., 200., 200., 200., 200.],</span>
<span class="go">        [200., 200., 200., 200., 200., 200., 200., 200., 200., 200.],</span>
<span class="go">        [200., 200., 200., 200., 200., 200., 200., 200., 200., 200.],</span>
<span class="go">        [200., 200., 200., 200., 200., 200., 200., 200., 200., 200.],</span>
<span class="go">        [200., 200., 200., 200., 200., 200., 200., 200., 200., 200.],</span>
<span class="go">        [200., 200., 200., 200., 200., 200., 200., 200., 200., 200.],</span>
<span class="go">        [200., 200., 200., 200., 200., 200., 200., 200., 200., 200.],</span>
<span class="go">        [200., 200., 200., 200., 200., 200., 200., 200., 200., 200.],</span>
<span class="go">        [200., 200., 200., 200., 200., 200., 200., 200., 200., 200.]],</span>
<span class="go">       dtype=float32),</span>
<span class="go"> array([[0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],</span>
<span class="go">        [0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],</span>
<span class="go">        [0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],</span>
<span class="go">        [0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],</span>
<span class="go">        [0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],</span>
<span class="go">        [0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],</span>
<span class="go">        [0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],</span>
<span class="go">        [0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],</span>
<span class="go">        [0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],</span>
<span class="go">        [0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01]],</span>
<span class="go">       dtype=float32))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference internal" href="../api_reference/smash/smash.Model.states.html#smash.Model.states" title="smash.Model.states"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.states</span></code></a> attribute stores the <strong>initial</strong> states <span class="math notranslate nohighlight">\(h(x,0)\)</span>.</p>
</div>
<p>If you are using IPython, tab completion allows you to visualize all the attributes and methods:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [32]: </span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.&lt;</span><span class="n">TAB</span><span class="o">&gt;</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">alpha</span>         <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">cp</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">beta</span>          <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">cst</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">cft</span>           <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">exc</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ci</span>            <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">from_handle</span><span class="p">(</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>         <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">lr</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [33]: </span><span class="n">model</span><span class="o">.</span><span class="n">states</span><span class="o">.&lt;</span><span class="n">TAB</span><span class="o">&gt;</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>         <span class="n">model</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">hlr</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">from_handle</span><span class="p">(</span>  <span class="n">model</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">hp</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">hft</span>           <span class="n">model</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">hst</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">hi</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
</div>
<div class="section" id="output">
<h3>Output<a class="headerlink" href="#output" title="Permalink to this heading">#</a></h3>
<p>The last attribute, <a class="reference internal" href="../api_reference/smash/smash.Model.output.html#smash.Model.output" title="smash.Model.output"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.output</span></code></a>, contains a set of arguments storing <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> outputs (i.e. simulated discharge, final states, cost …). The attribute values are empty as long as no simulation has been run.</p>
<p>If you are using IPython, tab completion allows you to visualize all the attributes and methods:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [34]: </span><span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.&lt;</span><span class="n">TAB</span><span class="o">&gt;</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">an</span>                   <span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">parameters_gradient</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>                <span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">qsim</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">cost</span>                 <span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">qsim_domain</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">from_handle</span><span class="p">(</span>         <span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">sp1</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">fstates</span>              <span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">sp2</span>
<span class="gp">   ....: </span><span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">ian</span>                  <span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">sparse_qsim_domain</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="input-data-filling">
<h2>Input Data filling<a class="headerlink" href="#input-data-filling" title="Permalink to this heading">#</a></h2>
<p>To run a simulation, the <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> needs at least one precipitation and potential evapotranspiration (PET) chronicle. In this Practice case, we will impose a triangular precipitation over the simulation period, uniform on the domain and a zero PET.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [35]: </span><span class="n">prcp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">prcp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="gp">In [36]: </span><span class="n">tri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">6.25</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="gp">In [37]: </span><span class="n">prcp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">tri</span>

<span class="gp">In [38]: </span><span class="n">prcp</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">19</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">tri</span><span class="p">)</span>

<span class="gp">In [39]: </span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">prcp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">prcp</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">prcp</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="gp">In [40]: </span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">pet</span> <span class="o">=</span> <span class="mf">0.</span>
</pre></div>
</div>
<p>Checking on any cell the precipitation values:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [41]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">prcp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:]);</span>

<span class="gp">In [42]: </span><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.7</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">);</span>

<span class="gp">In [43]: </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time step&quot;</span><span class="p">);</span>

<span class="gp">In [44]: </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Precipitation $(mm/h)$&quot;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../_images/prpc_pc_user_guide.png" src="../_images/prpc_pc_user_guide.png" />
</div>
<div class="section" id="run">
<h2>Run<a class="headerlink" href="#run" title="Permalink to this heading">#</a></h2>
<div class="section" id="forward-run">
<h3>Forward run<a class="headerlink" href="#forward-run" title="Permalink to this heading">#</a></h3>
<p>The <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> is finally ready to be run using the <a class="reference internal" href="../api_reference/smash/smash.Model.run.html#smash.Model.run" title="smash.Model.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.run()</span></code></a> method:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [45]: </span><span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">In [46]: </span><span class="n">model</span>
<span class="gh">Out[46]: </span><span class="go"></span>
<span class="go">Model dimension: (time: 72, nrow: 10, ncol: 10)</span>
<span class="go">Model last update: Forward Run</span>
</pre></div>
</div>
<p>Once the run is done, it is possible to access the simulated discharge on the gauge via the <a class="reference internal" href="../api_reference/smash/smash.Model.output.html#smash.Model.output" title="smash.Model.output"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Model.output</span></code></a> and to plot a hydrograph.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [47]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">qsim</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]);</span>

<span class="gp">In [48]: </span><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.7</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">);</span>

<span class="gp">In [49]: </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time step&quot;</span><span class="p">);</span>

<span class="gp">In [50]: </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Simulated discharge $(m^3/s)$&quot;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../_images/qsim_fwd_pc_user_guide.png" src="../_images/qsim_fwd_pc_user_guide.png" />
<p>This hydrograph is the result of a forward run of the code with the default structure, parameters and initial states.</p>
</div>
<div class="section" id="optimization">
<h3>Optimization<a class="headerlink" href="#optimization" title="Permalink to this heading">#</a></h3>
<p>To perform an optimization, observed discharge must be provided to <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a>. Since the Practice case is a ficticious catchment, we will use the simulated data from the previous forward run as observed discharge.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [51]: </span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">qobs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">qsim</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
<p>Next, we will perturb the production parameter <span class="math notranslate nohighlight">\(\mathrm{cp}\)</span> to generate a hydrograph different from the previous one.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [52]: </span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">cp</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Re run to see the difference between the hydrographs.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [53]: </span><span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">In [54]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">qobs</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observed discharge&quot;</span><span class="p">);</span>

<span class="gp">In [55]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">qsim</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Simulated discharge&quot;</span><span class="p">);</span>

<span class="gp">In [56]: </span><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.7</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">);</span>

<span class="gp">In [57]: </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time step&quot;</span><span class="p">);</span>

<span class="gp">In [58]: </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Discharge $(m^3/s)$&quot;</span><span class="p">);</span>

<span class="gp">In [59]: </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
<img alt="../_images/qsim_fwd2_pc_user_guide.png" src="../_images/qsim_fwd2_pc_user_guide.png" />
<p>Finally, perform a spatially uniform calibration of the parameter <span class="math notranslate nohighlight">\(\mathrm{cp}\)</span> with the <a class="reference internal" href="../api_reference/smash/smash.Model.optimize.html#smash.Model.optimize" title="smash.Model.optimize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.optimize()</span></code></a> method:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [60]: </span><span class="n">model</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="s2">&quot;sbs&quot;</span><span class="p">,</span> <span class="n">control_vector</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cp&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">In [61]: </span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">cp</span>
<span class="gh">Out[61]: </span><span class="go"></span>
<span class="go">array([[200.72115, 200.72115, 200.72115, 200.72115, 200.72115, 200.72115,</span>
<span class="go">        200.72115, 200.72115, 200.72115, 200.72115],</span>
<span class="go">       [200.72115, 200.72115, 200.72115, 200.72115, 200.72115, 200.72115,</span>
<span class="go">        200.72115, 200.72115, 200.72115, 200.72115],</span>
<span class="go">       [200.72115, 200.72115, 200.72115, 200.72115, 200.72115, 200.72115,</span>
<span class="go">        200.72115, 200.72115, 200.72115, 200.72115],</span>
<span class="go">       [200.72115, 200.72115, 200.72115, 200.72115, 200.72115, 200.72115,</span>
<span class="go">        200.72115, 200.72115, 200.72115, 200.72115],</span>
<span class="go">       [200.72115, 200.72115, 200.72115, 200.72115, 200.72115, 200.72115,</span>
<span class="go">        200.72115, 200.72115, 200.72115, 200.72115],</span>
<span class="go">       [200.72115, 200.72115, 200.72115, 200.72115, 200.72115, 200.72115,</span>
<span class="go">        200.72115, 200.72115, 200.72115, 200.72115],</span>
<span class="go">       [200.72115, 200.72115, 200.72115, 200.72115, 200.72115, 200.72115,</span>
<span class="go">        200.72115, 200.72115, 200.72115, 200.72115],</span>
<span class="go">       [200.72115, 200.72115, 200.72115, 200.72115, 200.72115, 200.72115,</span>
<span class="go">        200.72115, 200.72115, 200.72115, 200.72115],</span>
<span class="go">       [200.72115, 200.72115, 200.72115, 200.72115, 200.72115, 200.72115,</span>
<span class="go">        200.72115, 200.72115, 200.72115, 200.72115],</span>
<span class="go">       [200.72115, 200.72115, 200.72115, 200.72115, 200.72115, 200.72115,</span>
<span class="go">        200.72115, 200.72115, 200.72115, 200.72115]], dtype=float32)</span>

<span class="gp">In [62]: </span><span class="n">model</span>
<span class="gh">Out[62]: </span><span class="go"></span>
<span class="go">Model dimension: (time: 72, nrow: 10, ncol: 10)</span>
<span class="go">Model last update: Step By Step Optimization</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [63]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">qobs</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observed discharge&quot;</span><span class="p">);</span>

<span class="gp">In [64]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">qsim</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Simulated discharge&quot;</span><span class="p">);</span>

<span class="gp">In [65]: </span><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.7</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">);</span>

<span class="gp">In [66]: </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time step&quot;</span><span class="p">);</span>

<span class="gp">In [67]: </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Discharge $(m^3/s)$&quot;</span><span class="p">);</span>

<span class="gp">In [68]: </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
<img alt="../_images/qsim_opt_pc_user_guide.png" src="../_images/qsim_opt_pc_user_guide.png" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the Practice case, we will not go into the details of the optimization which is an essential part of the <a class="reference internal" href="../index.html#module-smash" title="smash"><code class="xref py py-obj docutils literal notranslate"><span class="pre">smash</span></code></a> calculation code. To go further, details can be found for the use of the <a class="reference internal" href="../api_reference/smash/smash.Model.optimize.html#smash.Model.optimize" title="smash.Model.optimize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.optimize()</span></code></a> method in the User Guide section: <a class="reference internal" href="real_case_cance.html#user-guide-real-case-cance"><span class="std std-ref">Real case - Cance</span></a> and for the algorithms in the Model description section: (TODO link).</p>
</div>
</div>
</div>
<div class="section" id="getting-data">
<h2>Getting data<a class="headerlink" href="#getting-data" title="Permalink to this heading">#</a></h2>
<p>The last step is to save what we have entered in <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> (i.e. <code class="docutils literal notranslate"><span class="pre">setup</span></code> and <code class="docutils literal notranslate"><span class="pre">mesh</span></code> dictionaries) and the <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> itself.</p>
<div class="section" id="setup-argument-in-out">
<h3>Setup argument in/out<a class="headerlink" href="#setup-argument-in-out" title="Permalink to this heading">#</a></h3>
<p>The setup dictionary <code class="docutils literal notranslate"><span class="pre">setup</span></code>, which was created in the section <a class="reference internal" href="#practice-case-setup-argument-creation"><span class="std std-ref">Setup argument creation</span></a>, can be saved in <a class="reference external" href="https://yaml.org/spec/1.2.2/">YAML</a> format via the method <a class="reference internal" href="../api_reference/smash/smash.save_setup.html#smash.save_setup" title="smash.save_setup"><code class="xref py py-meth docutils literal notranslate"><span class="pre">smash.save_setup()</span></code></a>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [69]: </span><span class="n">smash</span><span class="o">.</span><span class="n">save_setup</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="s2">&quot;setup.yaml&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>A file named <code class="docutils literal notranslate"><span class="pre">setup.yaml</span></code> has been created in the current working directory containing the <code class="docutils literal notranslate"><span class="pre">setup</span></code> dictionary information. This file can itself be opened in order to recover our initial <code class="docutils literal notranslate"><span class="pre">setup</span></code> dictionary via the method <a class="reference internal" href="../api_reference/smash/smash.read_setup.html#smash.read_setup" title="smash.read_setup"><code class="xref py py-meth docutils literal notranslate"><span class="pre">smash.read_setup()</span></code></a>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [70]: </span><span class="n">setup2</span> <span class="o">=</span> <span class="n">smash</span><span class="o">.</span><span class="n">read_setup</span><span class="p">(</span><span class="s2">&quot;setup.yaml&quot;</span><span class="p">)</span>

<span class="gp">In [71]: </span><span class="n">setup2</span>
<span class="gh">Out[71]: </span><span class="go">{&#39;dt&#39;: 3600, &#39;end_time&#39;: &#39;2020-01-04 00:00&#39;, &#39;start_time&#39;: &#39;2020-01-01 00:00&#39;}</span>
</pre></div>
</div>
</div>
<div class="section" id="mesh-argument-in-out">
<h3>Mesh argument in/out<a class="headerlink" href="#mesh-argument-in-out" title="Permalink to this heading">#</a></h3>
<p>In a similar way to <code class="docutils literal notranslate"><span class="pre">setup</span></code> dictionary, the <code class="docutils literal notranslate"><span class="pre">mesh</span></code> dictionary created in the section <a class="reference internal" href="#practice-case-mesh-argument-creation"><span class="std std-ref">Mesh argument creation</span></a> can be saved to file via the method <a class="reference internal" href="../api_reference/smash/smash.save_mesh.html#smash.save_mesh" title="smash.save_mesh"><code class="xref py py-meth docutils literal notranslate"><span class="pre">smash.save_mesh()</span></code></a>. However, 3D NumPy arrays cannot be saved in YAML format, so the <code class="docutils literal notranslate"><span class="pre">mesh</span></code> is saved in <a class="reference external" href="https://www.hdfgroup.org/solutions/hdf5/">HDF5</a> format.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [72]: </span><span class="n">smash</span><span class="o">.</span><span class="n">save_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;mesh.hdf5&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>A file named <code class="docutils literal notranslate"><span class="pre">mesh.hdf5</span></code> has been created in the current working directory containing the <code class="docutils literal notranslate"><span class="pre">mesh</span></code> dictionary information. This file can itself be opened in order to recover our initial <code class="docutils literal notranslate"><span class="pre">mesh</span></code> dictionary via the method <a class="reference internal" href="../api_reference/smash/smash.read_mesh.html#smash.read_mesh" title="smash.read_mesh"><code class="xref py py-meth docutils literal notranslate"><span class="pre">smash.read_mesh()</span></code></a>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [73]: </span><span class="n">mesh2</span> <span class="o">=</span> <span class="n">smash</span><span class="o">.</span><span class="n">read_mesh</span><span class="p">(</span><span class="s2">&quot;mesh.hdf5&quot;</span><span class="p">)</span>

<span class="gp">In [74]: </span><span class="n">mesh2</span>
<span class="gh">Out[74]: </span><span class="go"></span>
<span class="go">{&#39;area&#39;: 100000000,</span>
<span class="go"> &#39;dx&#39;: 1000,</span>
<span class="go"> &#39;nac&#39;: 100,</span>
<span class="go"> &#39;ncol&#39;: 10,</span>
<span class="go"> &#39;ng&#39;: 1,</span>
<span class="go"> &#39;nrow&#39;: 10,</span>
<span class="go"> &#39;drained_area&#39;: array([[  1,   1,   1,   1,   1,   1,   1,   1,   1,   1],</span>
<span class="go">        [  1,   4,   2,   2,   2,   2,   2,   2,   2,   2],</span>
<span class="go">        [  1,   2,   9,   3,   3,   3,   3,   3,   3,   3],</span>
<span class="go">        [  1,   2,   3,  16,   4,   4,   4,   4,   4,   4],</span>
<span class="go">        [  1,   2,   3,   4,  25,   5,   5,   5,   5,   5],</span>
<span class="go">        [  1,   2,   3,   4,   5,  36,   6,   6,   6,   6],</span>
<span class="go">        [  1,   2,   3,   4,   5,   6,  49,   7,   7,   7],</span>
<span class="go">        [  1,   2,   3,   4,   5,   6,   7,  64,   8,   8],</span>
<span class="go">        [  1,   2,   3,   4,   5,   6,   7,   8,  81,   9],</span>
<span class="go">        [  1,   2,   3,   4,   5,   6,   7,   8,   9, 100]], dtype=int32),</span>
<span class="go"> &#39;flwdir&#39;: array([[4, 5, 5, 5, 5, 5, 5, 5, 5, 5],</span>
<span class="go">        [3, 4, 5, 5, 5, 5, 5, 5, 5, 5],</span>
<span class="go">        [3, 3, 4, 5, 5, 5, 5, 5, 5, 5],</span>
<span class="go">        [3, 3, 3, 4, 5, 5, 5, 5, 5, 5],</span>
<span class="go">        [3, 3, 3, 3, 4, 5, 5, 5, 5, 5],</span>
<span class="go">        [3, 3, 3, 3, 3, 4, 5, 5, 5, 5],</span>
<span class="go">        [3, 3, 3, 3, 3, 3, 4, 5, 5, 5],</span>
<span class="go">        [3, 3, 3, 3, 3, 3, 3, 4, 5, 5],</span>
<span class="go">        [3, 3, 3, 3, 3, 3, 3, 3, 4, 5],</span>
<span class="go">        [3, 3, 3, 3, 3, 3, 3, 3, 3, 4]], dtype=int32),</span>
<span class="go"> &#39;gauge_pos&#39;: array([10, 10], dtype=int32),</span>
<span class="go"> &#39;path&#39;: array([[ 1,  7,  9,  6, 10,  5,  4,  3,  2,  8,  1,  1,  1,  1,  1,  1,</span>
<span class="go">          1,  1,  1,  2, 10,  2,  2,  4,  2,  2,  9,  6,  5,  8,  2,  7,</span>
<span class="go">          3,  2,  2,  6,  9, 10,  7,  5,  8,  4,  3,  3,  3,  3,  3,  3,</span>
<span class="go">          3,  4,  2,  8,  4,  6, 10,  9,  4,  4,  4,  5,  7,  4,  8,  9,</span>
<span class="go">         10,  5,  5,  5,  5,  7,  6,  5,  9,  7,  8, 10,  6,  6,  6,  6,</span>
<span class="go">          8, 10,  7,  7,  7,  9,  8,  8,  9, 10, 10,  3,  9,  4,  5,  6,</span>
<span class="go">          7,  8,  9, 10],</span>
<span class="go">        [ 1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  9, 10,  5,  4,  7,  3,</span>
<span class="go">          2,  8,  6, 10,  2,  3,  4,  2,  5,  9,  2,  2,  2,  2,  7,  2,</span>
<span class="go">          2,  8,  6,  3,  3,  3,  3,  3,  3,  3,  4,  5,  6,  7,  8, 10,</span>
<span class="go">          9,  9,  2,  4, 10,  4,  4,  4,  5,  6,  7,  4,  4,  8,  5,  5,</span>
<span class="go">          5, 10,  7,  8,  9,  5,  5,  6,  6,  6,  6,  6,  8,  9, 10,  7,</span>
<span class="go">          7,  7, 10,  9,  8,  7,  9, 10,  8,  8,  9,  3, 10,  4,  5,  6,</span>
<span class="go">          7,  8,  9, 10]], dtype=int32)}</span>
</pre></div>
</div>
<p>A new <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> object can be created from the read files (same as the first one).</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [75]: </span><span class="n">model2</span> <span class="o">=</span> <span class="n">smash</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">setup2</span><span class="p">,</span> <span class="n">mesh2</span><span class="p">)</span>

<span class="gp">In [76]: </span><span class="n">model2</span>
<span class="gh">Out[76]: </span><span class="go"></span>
<span class="go">Model dimension: (time: 72, nrow: 10, ncol: 10)</span>
<span class="go">Model last update: Initialization</span>
</pre></div>
</div>
</div>
<div class="section" id="model-in-out">
<h3>Model in/out<a class="headerlink" href="#model-in-out" title="Permalink to this heading">#</a></h3>
<p>The <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> object can also be saved to file. Like the <code class="docutils literal notranslate"><span class="pre">mesh</span></code>, it will be saved in HDF5 format using the <a class="reference internal" href="../api_reference/smash/smash.save_model.html#smash.save_model" title="smash.save_model"><code class="xref py py-meth docutils literal notranslate"><span class="pre">smash.save_model()</span></code></a> method. Here, we will save the <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> object <code class="docutils literal notranslate"><span class="pre">model</span></code> after optimization.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [77]: </span><span class="n">smash</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;model.hdf5&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>A file named <code class="docutils literal notranslate"><span class="pre">model.hdf5</span></code> has been created in the current working directory containing the <code class="docutils literal notranslate"><span class="pre">model</span></code> object information. This file can itself be opened in order to recover our initial <code class="docutils literal notranslate"><span class="pre">model</span></code> object via the method <a class="reference internal" href="../api_reference/smash/smash.read_model.html#smash.read_model" title="smash.read_model"><code class="xref py py-meth docutils literal notranslate"><span class="pre">smash.read_model()</span></code></a>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [78]: </span><span class="n">model3</span> <span class="o">=</span> <span class="n">smash</span><span class="o">.</span><span class="n">read_model</span><span class="p">(</span><span class="s2">&quot;model.hdf5&quot;</span><span class="p">)</span>

<span class="gp">In [79]: </span><span class="n">model3</span>
<span class="gh">Out[79]: </span><span class="go"></span>
<span class="go">Model dimension: (time: 72, nrow: 10, ncol: 10)</span>
<span class="go">Model last update: Step By Step Optimization</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">model3</span></code> is directly the <a class="reference internal" href="../api_reference/smash/smash.Model.html#smash.Model" title="smash.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> object itself on which the methods associated with the object are applicable.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [80]: </span><span class="n">model3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">In [81]: </span><span class="n">model3</span>
<span class="gh">Out[81]: </span><span class="go"></span>
<span class="go">Model dimension: (time: 72, nrow: 10, ncol: 10)</span>
<span class="go">Model last update: Forward Run</span>
</pre></div>
</div>
</div>
</div>
</div>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="index.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">User guide</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="real_case_cance.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Real case - Cance</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-object-creation">
   Model object creation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup-argument-creation">
     Setup argument creation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mesh-argument-creation">
     Mesh argument creation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#viewing-model">
   Viewing Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup">
     Setup
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mesh">
     Mesh
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#input-data">
     Input Data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#parameters-and-states">
     Parameters and States
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#output">
     Output
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#input-data-filling">
   Input Data filling
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run">
   Run
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#forward-run">
     Forward run
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimization">
     Optimization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#getting-data">
   Getting data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup-argument-in-out">
     Setup argument in/out
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mesh-argument-in-out">
     Mesh argument in/out
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-in-out">
     Model in/out
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../_sources/user_guide/practice_case.rst.txt">
        <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1e1de1a1873e13ef5536"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2022, Francois Colleoni.<br>

</p>

  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.0.0+.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>